{% extends 'header.html' %}

{% block title %}Breeder{% endblock %}

{% block header %}Breeder{% endblock %}

{% block content %}
<form method="post" class="my-4" id="breederForm">
    <!-- Update the dropdowns to use Datalist -->
    <div class="mb-3">
        <label for="dropdown1" class="form-label">Select the First parent:</label>
        <img id="imageContainer1" src="" alt="" style="max-width: 100px; max-height: 200px;">
        <select name="dropdown1" id="dropdown1" class="form-control">
            <option selected value=""></option>
            {% for index, item in dict_paldeck.items() %}
                <option value="{{ index }}" data-img="{{ item['ImageUrl'] }}">{{ item['Name'] }}</option>
            {% endfor %}
        </select>
    </div>
    
    <div class="mb-3">
        <label for="dropdown2" class="form-label">Select the Second parent:</label>
        <img id="imageContainer2" src="" alt="" style="max-width: 100px; max-height: 200px;">
        <select name="dropdown2" id="dropdown2" class="form-control">
            <option selected value=""></option>
            {% for index, item in dict_paldeck.items() %}
                <option value="{{ index }}" data-img="{{ item['ImageUrl'] }}">{{ item['Name'] }}</option>
            {% endfor %}
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Submit</button>

    {% if child_result %}
    <p>Child Result: {{ child_result['Name'] }}</p>
    <!-- Display the image using the img tag -->
    <img src="{{ child_result['ImageUrl'] }}" alt="Child Image" style="max-width: 100px; max-height: 200px;">
{% endif %}


<script>
    // Use JavaScript to update images based on selected option for the first dropdown
    document.getElementById('dropdown1').addEventListener('change', function() {
        updateImage('dropdown1', 'imageContainer1');
    });

    // Use JavaScript to update images based on selected option for the second dropdown
    document.getElementById('dropdown2').addEventListener('change', function() {
        updateImage('dropdown2', 'imageContainer2');
    });

    // Check if there are stored values and update dropdowns accordingly
    window.onload = function() {
        var storedValue1 = localStorage.getItem('selectedValue1');
        if (storedValue1) {
            document.getElementById('dropdown1').value = storedValue1;
            updateImage('dropdown1', 'imageContainer1');
        }

        var storedValue2 = localStorage.getItem('selectedValue2');
        if (storedValue2) {
            document.getElementById('dropdown2').value = storedValue2;
            updateImage('dropdown2', 'imageContainer2');
        }
    };

    function updateImage(dropdownId, containerId) {
        var selectedOption = document.getElementById(dropdownId).value;
        var imageContainer = document.getElementById(containerId);

        // Get the image URL from the data-img attribute
        var imageUrl = document.querySelector('#' + dropdownId + ' option[value="' + selectedOption + '"]').getAttribute('data-img');

        // Update the image container
        imageContainer.src = imageUrl;

        // Store the selected value in localStorage
        if (dropdownId === 'dropdown1') {
            localStorage.setItem('selectedValue1', selectedOption);
        } else if (dropdownId === 'dropdown2') {
            localStorage.setItem('selectedValue2', selectedOption);
        }

        // Use Fetch API to send an asynchronous request to the server
        fetch('/breeder/update_images', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                selectedOption: selectedOption,
                dropdownId: dropdownId,
            }),
        });
    }
</script>




{% endblock %}
